apiVersion: v1
kind: Namespace
metadata:
  name: group17-namespace

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql-db
  namespace: group17-namespace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mysql-db
  template:
    metadata:
      labels:
        app: mysql-db
    spec:
      containers:
      - name: mysql-db
        image: registry.cn-hangzhou.aliyuncs.com/group17/mysql-db:latest
        ports:
        - containerPort: 3306
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: "1234"
        - name: MYSQL_DATABASE·
          value: "thesis"
#        volumeMounts:
#        - name: mysql-data
#          mountPath: /var/lib/mysql

---

apiVersion: v1
kind: Service
metadata:
  name: mysql-db
  namespace: group17-namespace
spec:
  selector:
    app: mysql-db
  ports:
    - protocol: TCP
      port: 3307
      targetPort: 3306

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: gateway
  namespace: group17-namespace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: gateway
  template:
    metadata:
      labels:
        app: gateway
    spec:
      containers:
      - name: gateway
        image: registry.cn-hangzhou.aliyuncs.com/group17/gateway:latest
        ports:
        - containerPort: 9999

---

apiVersion: v1
kind: Service
metadata:
  name: gateway
  namespace: group17-namespace
spec:
  selector:
    app: gateway
  ports:
    - protocol: TCP
      port: 9999
      targetPort: 9999

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: eureka
  namespace: group17-namespace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: eureka
  template:
    metadata:
      labels:
        app: eureka
    spec:
      containers:
      - name: eureka
        image: registry.cn-hangzhou.aliyuncs.com/group17/eureka:latest
        ports:
        - containerPort: 7887

---

apiVersion: v1
kind: Service
metadata:
  name: eureka
  namespace: group17-namespace
spec:
  selector:
    app: eureka
  ports:
    - protocol: TCP
      port: 7887
      targetPort: 7887

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: conferences-serve
  namespace: group17-namespace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: conferences-serve
  template:
    metadata:
      labels:
        app: conferences-serve
    spec:
      containers:
      - name: conferences-serve
        image: registry.cn-hangzhou.aliyuncs.com/group17/conferences-serve:latest
        ports:
        - containerPort: 10004
        env:
        - name: SPRING_DATASOURCE_URL
          value: jdbc:mysql://mysql-db:3306/thesis
        - name: SPRING_DATASOURCE_USERNAME
          value: root
        - name: SPRING_DATASOURCE_PASSWORD
          value: "1234"

---

apiVersion: v1
kind: Service
metadata:
  name: conferences-serve
  namespace: group17-namespace
spec:
  selector:
    app: conferences-serve
  ports:
    - protocol: TCP
      port: 10004
      targetPort: 10004

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: paper-serve
  namespace: group17-namespace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: paper-serve
  template:
    metadata:
      labels:
        app: paper-serve
    spec:
      containers:
      - name: paper-serve
        image: registry.cn-hangzhou.aliyuncs.com/group17/paper-serve:latest
        ports:
        - containerPort: 10005
        env:
        - name: SPRING_DATASOURCE_URL
          value: jdbc:mysql://mysql-db:3306/thesis
        - name: SPRING_DATASOURCE_USERNAME
          value: root
        - name: SPRING_DATASOURCE_PASSWORD
          value: "1234"

---

apiVersion: v1
kind: Service
metadata:
  name: paper-serve
  namespace: group17-namespace
spec:
  selector:
    app: paper-serve
  ports:
    - protocol: TCP
      port: 10005
      targetPort: 10005

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: role-serve
  namespace: group17-namespace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: role-serve
  template:
    metadata:
      labels:
        app: role-serve
    spec:
      containers:
      - name: role-serve
        image: registry.cn-hangzhou.aliyuncs.com/group17/role-serve:latest
        ports:
        - containerPort: 10001
        env:
        - name: SPRING_DATASOURCE_URL
          value: jdbc:mysql://mysql-db:3306/thesis
        - name: SPRING_DATASOURCE_USERNAME
          value: root
        - name: SPRING_DATASOURCE_PASSWORD
          value: "1234"

---

apiVersion: v1
kind: Service
metadata:
  name: role-serve
  namespace: group17-namespace
spec:
  selector:
    app: role-serve
  ports:
    - protocol: TCP
      port: 10001
      targetPort: 10001

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-serve
  namespace: group17-namespace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: user-serve
  template:
    metadata:
      labels:
        app: user-serve
    spec:
      containers:
      - name: user-serve
        image: registry.cn-hangzhou.aliyuncs.com/group17/user-serve:latest
        ports:
        - containerPort: 10002
        env:
        - name: SPRING_DATASOURCE_URL
          value: jdbc:mysql://mysql-db:3306/thesis
        - name: SPRING_DATASOURCE_USERNAME
          value: root
        - name: SPRING_DATASOURCE_PASSWORD
          value: "1234"

---

apiVersion: v1
kind: Service
metadata:
  name: user-serve
  namespace: group17-namespace
spec:
  selector:
    app: user-serve
  ports:
    - protocol: TCP
      port: 10002
      targetPort: 10002

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend
  namespace: group17-namespace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: frontend
    spec:
      containers:
      - name: frontend
        image: registry.cn-hangzhou.aliyuncs.com/group17/frontend:latest
        ports:
        - containerPort: 8889
      # 如果前端应用需要连接后端服务，你可能需要在这里添加一些环境变量

---

apiVersion: v1
kind: Service
metadata:
  name: frontend
  namespace: group17-namespace
spec:
  selector:
    app: frontend
  ports:
    - protocol: TCP
      port: 8889
      targetPort: 8889

---

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: group17-ingress
  namespace: group17-namespace
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: group17-domain.com
    http:
      paths:
      - path: /conferences-serve
        pathType: Prefix
        backend:
          service:
            name: conferences-serve
            port:
              number: 10004
      - path: /paper-serve
        pathType: Prefix
        backend:
          service:
            name: paper-serve
            port:
              number: 10005
      - path: /role-serve
        pathType: Prefix
        backend:
          service:
            name: role-serve
            port:
              number: 10001
      - path: /user-serve
        pathType: Prefix
        backend:
          service:
            name: user-serve
            port:
              number: 10002
      - path: /frontend
        pathType: Prefix
        backend:
          service:
            name: frontend
            port:
              number: 8889





